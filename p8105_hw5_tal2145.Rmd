---
title: "Homework 5"
author: Troy Layouni
output: github_document
---

```{r setup, include=FALSE}
library(viridis)
library(tidyverse)
library(readr)
library(ggridges)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## Problem 1
***

**Loading in `iris` dataset with missing values**

```{r load_iris_with_missing}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

#### Writing a function to replace missing values 

* missing numeric values are filled in with the mean of non-missing values 
* missing character values are filled in with `"virginica"

```{r no_missing_df}
fix_missing = function(x) {
  if (is.numeric(x)) {
    replace_na(x, mean(x, na.rm = TRUE))
  } else if (is.character(x)) {
  replace_na(x, "virginica")
  }
}

iris_no_missing = map_dfr(iris_with_missing, fix_missing)
```

## Problem 2
***

#### Part 1: Loading and tidying control and experimental arm data** 

* reading in all files from each subject into one dataframe
* tidying data to include 4 columns with study arm, id, week and 


```{r study_data_load}
read_files = function(file) {
  study_data = read_csv(file)
}

path_base = "./data/"

study_data = 
  tibble(
    file_name = list.files(path = "./data/"),
    all_files = str_c(path_base, file_name)) %>% 
  mutate(study_data = map(all_files, read_files)) %>% 
  unnest() %>% 
  select(-all_files) %>% 
  separate(file_name, into = c("study_arm", "subject_id"), sep = "\\_") %>% 
  pivot_longer(
    week_1:week_8, 
    names_to = "week", 
    values_to = "observation"
    ) %>% 
  mutate(
    subject_id = str_replace(subject_id, ".csv", ""),
    week = str_replace(week, "week_", ""),
    study_arm = str_replace(study_arm, "con", "control"),
    study_arm = str_replace(study_arm, "exp", "experimental")
)
```

#### Part 2: Making a spaghetti plot showing observations over time and differences between study arms

```{r}
study_data %>% 
  group_by(study_arm, subject_id) %>% 
  
  ggplot(aes(x = week, y = observation, color = study_arm, group = interaction(study_arm, subject_id))) +
  #geom_point() + 
  geom_line() +
    labs(
   title = "Subject Observations Over Time",
   x = "Week",
   y = "Observation"
  ) 
```

Looking at the spaghetti plot where yellow represents the experimental arm and purple represents the control arm, we see that the values of weekly observations for the experimental subjects is higher on average than that of the control arm. There appears to be a positive trend in observation value and increasing week of observation among the experimental subjects. At the end of the observed time, all participants in the experimental arm have higher observation values than all of the controls. 

## Problem 3
***

#### Part 1: 

```{r}
set.seed(1)

sim_regression = function(n, beta0 = 2, beta1 = 0) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = 50),
    y = beta0 + beta1 * x + rnorm(n, 0, 1)
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta0_hat = coef(ls_fit)[1],
    beta1_hat = coef(ls_fit)[2]
  )
}

```

